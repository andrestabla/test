<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BaterÃ­a MD-IA (AlgoritmoT) â€“ Cuestionario interactivo</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <style>
    :root {
      --bg: #0b1021;
      --card: #0f172a;
      --panel: #11182f;
      --border: #1e293b;
      --accent: #2563eb;
      --accent-2: #22c55e;
      --accent-3: #06b6d4;
      --text: #e2e8f0;
      --muted: #94a3b8;
      --shadow: 0 24px 60px rgba(0,0,0,0.45);
      --radius: 18px;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: radial-gradient(circle at 20% 20%, #0f172a 0%, #020617 60%);
      color: var(--text);
      min-height: 100vh;
      padding: 20px 12px 36px;
    }
    .layout { max-width: 1280px; margin: 0 auto; }
    header {
      background: linear-gradient(120deg, rgba(37,99,235,0.12), rgba(6,182,212,0.12));
      border: 1px solid rgba(59,130,246,0.25);
      border-radius: 22px;
      padding: 18px;
      box-shadow: var(--shadow);
      display: grid;
      gap: 10px;
      grid-template-columns: minmax(0,2.2fr) minmax(280px,1fr);
    }
    h1 { font-size: 24px; font-weight: 600; margin-bottom: 6px; }
    p { color: var(--muted); line-height: 1.4; }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.06);
      color: var(--muted);
      border-radius: 999px;
      font-size: 12px;
    }
    .badge { width: 10px; height: 10px; border-radius: 999px; background: var(--accent-2); }
    .hero-score { font-size: 32px; font-weight: 700; }
    .hero-score small { font-size: 14px; color: var(--muted); font-weight: 500; margin-left: 4px; }
    .hero-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px,1fr)); gap: 10px; margin-top: 10px; }
    .stat {
      background: var(--panel);
      border: 1px solid var(--border);
      padding: 12px;
      border-radius: var(--radius);
    }
    .stat label { display: block; font-size: 12px; color: var(--muted); margin-bottom: 4px; }
    .stat strong { font-size: 18px; }
    .download {
      margin-top: 10px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 12px;
      background: linear-gradient(120deg, rgba(37,99,235,0.18), rgba(34,197,94,0.14));
      border: 1px solid rgba(59,130,246,0.35);
      color: #e2e8f0;
      text-decoration: none;
      font-weight: 600;
      font-size: 14px;
      box-shadow: 0 12px 30px rgba(37,99,235,0.25);
    }
    .download:hover { filter: brightness(1.05); }
    nav.tabs {
      margin-top: 16px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--border);
      padding: 6px;
      border-radius: 14px;
      position: sticky;
      top: 8px;
      z-index: 10;
      backdrop-filter: blur(10px);
    }
    .tab-btn {
      border: none;
      background: transparent;
      color: var(--muted);
      padding: 10px 12px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.15s ease-in-out;
      font-size: 13px;
    }
    .tab-btn.active { background: var(--card); color: var(--text); border: 1px solid var(--border); box-shadow: 0 10px 30px rgba(0,0,0,0.28); }
    .panel { display: none; margin-top: 14px; }
    .panel.active { display: block; }
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 14px 14px 16px;
      box-shadow: var(--shadow);
    }
    .card + .card { margin-top: 12px; }
    .card-header { display: flex; align-items: baseline; justify-content: space-between; gap: 10px; margin-bottom: 8px; }
    .card-title { font-size: 16px; font-weight: 600; }
    .card-subtitle { color: var(--muted); font-size: 13px; }
    .progress {
      width: 100%;
      height: 9px;
      background: #0b1221;
      border-radius: 999px;
      overflow: hidden;
      border: 1px solid var(--border);
      margin-top: 6px;
    }
    .progress-bar { height: 100%; background: linear-gradient(90deg, var(--accent), var(--accent-2)); width: 0%; transition: width 0.25s ease; }
    .grid { display: grid; gap: 12px; }
    .grid-2 { grid-template-columns: minmax(0,1.4fr) minmax(260px,1fr); }
    .question-list { display: grid; gap: 10px; margin-top: 10px; }
    .question {
      background: var(--panel);
      border: 1px solid var(--border);
      padding: 10px 12px;
      border-radius: 14px;
    }
    .question h4 { font-size: 13px; margin-bottom: 8px; }
    .options { display: grid; grid-template-columns: repeat(auto-fit, minmax(90px, 1fr)); gap: 6px; }
    .options label {
      display: flex;
      align-items: center;
      gap: 6px;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 10px;
      padding: 6px 8px;
      cursor: pointer;
      font-size: 12px;
    }
    .options input { accent-color: var(--accent); }
    button.submit {
      margin-top: 12px;
      background: linear-gradient(120deg, var(--accent), var(--accent-3));
      color: #0b1021;
      border: none;
      padding: 12px 14px;
      border-radius: 12px;
      font-weight: 700;
      cursor: pointer;
      width: 100%;
      box-shadow: 0 16px 40px rgba(37,99,235,0.35);
    }
    .status { margin-top: 8px; font-size: 12px; color: var(--muted); }
    .chip { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 999px; background: rgba(255,255,255,0.04); border: 1px solid var(--border); font-size: 12px; }
    .chart-wrap { background: var(--panel); border: 1px solid var(--border); border-radius: var(--radius); padding: 12px; }
    .muted { color: var(--muted); }
    .flex { display: flex; align-items: center; gap: 10px; }
    .small { font-size: 12px; }
    #dimensionInsights, #actionsContainer { grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }
    .insight-card { background: var(--panel); border: 1px solid var(--border); border-radius: var(--radius); padding: 12px; display: grid; gap: 6px; }
    .insight-head { display: flex; justify-content: space-between; gap: 10px; align-items: center; }
    .level { padding: 4px 8px; border-radius: 999px; font-size: 12px; border: 1px solid var(--border); }
    .level.bajo { background: rgba(239,68,68,0.15); border-color: rgba(239,68,68,0.3); color: #fca5a5; }
    .level.intermedio { background: rgba(245,158,11,0.15); border-color: rgba(245,158,11,0.3); color: #fcd34d; }
    .level.alto { background: rgba(34,197,94,0.18); border-color: rgba(34,197,94,0.35); color: #bbf7d0; }
    .action-card { background: var(--panel); border: 1px solid var(--border); border-radius: var(--radius); padding: 12px; display: grid; gap: 8px; }
    .pill-sm { display: inline-flex; align-items: center; gap: 6px; padding: 4px 8px; border-radius: 999px; background: rgba(255,255,255,0.04); border: 1px solid var(--border); font-size: 11px; }
    .list { padding-left: 18px; color: var(--muted); font-size: 12px; }
    @media (max-width: 920px) {
      header { grid-template-columns: 1fr; }
      .grid-2 { grid-template-columns: 1fr; }
      nav.tabs { position: static; }
    }
  </style>
</head>
<body>
  <div class="layout">
    <header>
      <div>
        <h1>BaterÃ­a de preguntas MD-IA (AlgoritmoT)</h1>
        <p>Encuesta interactiva de 180 preguntas (6 dimensiones). Usa la escala 1â€“5: 1 = No se hace, 5 = Totalmente optimizado. EnvÃ­a cada dimensiÃ³n para generar el tablero de resultados, DQ y AIQ.</p>
        <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;">
          <span class="pill"><span class="badge"></span> Cuestionario completo (30 preguntas por dimensiÃ³n)</span>
          <span class="pill">Dashboard dinÃ¡mico Â· Radar + barras</span>
          <span class="pill">CÃ¡lculo DQ / AIQ (ponderaciÃ³n sugerida)</span>
        </div>
        <button type="button" class="download" id="downloadZip">
          Generar paquete offline
        </button>
        <div class="small muted" id="downloadStatus">Genera el paquete sin descargar archivos binarios del repositorio.</div>
      </div>
      <div>
        <div class="stat" style="margin-bottom:8px;">
          <label>Progreso general</label>
          <div class="hero-score" id="progressPercent">0%</div>
          <div class="progress"><div class="progress-bar" id="progressBar"></div></div>
          <div class="small muted" id="progressDetail">0 de 180 respuestas registradas</div>
        </div>
        <div class="hero-grid">
          <div class="stat">
            <label>Dimensiones enviadas</label>
            <strong id="dimsSubmitted">0 / 6</strong>
            <div class="small muted">Requiere 30 respuestas por dimensiÃ³n</div>
          </div>
          <div class="stat">
            <label>DQ (Digital Quotient)</label>
            <strong id="dqScore">â€”</strong>
            <div class="small muted" id="dqNote">Esperando envÃ­os</div>
          </div>
          <div class="stat">
            <label>AIQ (AI Quotient)</label>
            <strong id="aiqScore">â€”</strong>
            <div class="small muted" id="aiqNote">PonderaciÃ³n IA aplicada</div>
          </div>
        </div>
      </div>
    </header>

    <nav class="tabs" id="tabs"></nav>

    <section class="panel active" id="panel-resumen">
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">Tablero de progreso por dimensiÃ³n</div>
            <div class="card-subtitle">Visualiza cuÃ¡nto falta por completar cada bloque antes de enviarlo.</div>
          </div>
        </div>
        <div class="grid" id="dimensionProgress"></div>
      </div>
    </section>

    <div id="panels"></div>

    <section class="panel" id="panel-resultados">
      <div class="grid grid-2">
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">Radar de madurez por dimensiÃ³n</div>
              <div class="card-subtitle">Actualiza cada vez que envÃ­as una dimensiÃ³n.</div>
            </div>
            <span class="chip" id="resultStatus">Pendiente de envÃ­os</span>
          </div>
          <div class="chart-wrap"><canvas id="radarChart"></canvas></div>
        </div>
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">DQ y AIQ vs avance</div>
              <div class="card-subtitle">Promedio (DQ) y ponderaciÃ³n IA (AIQ).</div>
            </div>
          </div>
          <div class="chart-wrap"><canvas id="barChart"></canvas></div>
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">Resultados por dimensiÃ³n</div>
            <div class="card-subtitle">AnÃ¡lisis e interpretaciÃ³n automÃ¡tica al enviar cada bloque.</div>
          </div>
          <span class="chip">Niveles: Bajo Â· Intermedio Â· Alto</span>
        </div>
        <div class="grid" id="dimensionInsights"></div>
      </div>
    </section>

    <section class="panel" id="panel-acciones">
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">LÃ­neas de acciÃ³n sugeridas</div>
            <div class="card-subtitle">Quick wins y prÃ³ximos pasos para cerrar brechas segÃºn las respuestas.</div>
          </div>
          <span class="chip" id="actionStatus">Esperando envÃ­os</span>
        </div>
        <div class="grid" id="actionsContainer"></div>
      </div>
    </section>
  </div>

<script>
  const dimensions = [
    { id: 'estrategia', name: 'Estrategia', weightAIQ: 0.25 },
    { id: 'infra', name: 'Infraestructura & Datos', weightAIQ: 0.30 },
    { id: 'talento', name: 'Talento & Cultura', weightAIQ: 0.10 },
    { id: 'gob', name: 'Gobernanza & Liderazgo', weightAIQ: 0.25 },
    { id: 'procesos', name: 'Procesos & AutomatizaciÃ³n', weightAIQ: 0.05 },
    { id: 'cx', name: 'Experiencia del cliente', weightAIQ: 0.05 },
  ];

  const questions = {
    estrategia: [
      'Â¿Existe una visiÃ³n y misiÃ³n formalmente definidas que incluyan transformaciÃ³n digital e IA?',
      'Â¿La estrategia digital estÃ¡ documentada y aprobada por la alta direcciÃ³n?',
      'Â¿La estrategia digital e IA se revisa y actualiza periÃ³dicamente?',
      'Â¿Los objetivos digitales se encuentran alineados a las metas de negocio (crecimiento, rentabilidad, experiencia cliente, etc.)?',
      'Â¿Hay un portafolio de iniciativas digitales priorizado basado en valor y factibilidad?',
      'Â¿La alta direcciÃ³n participa activamente en iniciativas digitales (patrocinio)?',
      'Â¿Se cuenta con roles dedicados a impulsar la transformaciÃ³n digital (p.ej., Chief Digital Officer)?',
      'Â¿La estrategia digital contempla una hoja de ruta de adopciÃ³n de IA?',
      'Â¿Se han definido indicadores (KPIs) para medir el avance de la estrategia digital?',
      'Â¿La empresa tiene un presupuesto especÃ­fico para proyectos digitales e IA?',
      'Â¿Se aprovechan alianzas con startups, universidades o proveedores tecnolÃ³gicos para acelerar la transformaciÃ³n?',
      'Â¿Se consideran oportunidades de nuevos modelos de negocio digitales (suscripciones, plataformas, servicios basados en datos)?',
      'Â¿La estrategia digital incluye experimentaciÃ³n y pilotos de tecnologÃ­as emergentes (IoT, IA generativa, blockchain)?',
      'Â¿Se evalÃºan los riesgos digitales (ciberseguridad, privacidad, impactos Ã©ticos) como parte de la estrategia?',
      'Â¿Se articulan iniciativas digitales con la estrategia de sostenibilidad/responsabilidad social?',
      'Â¿Existe un roadmap especÃ­fico de adopciÃ³n de IA alineado a procesos clave?',
      'Â¿Se han identificado casos de uso de IA prioritarios con impacto en el negocio?',
      'Â¿Se evalÃºa el retorno de inversiÃ³n de proyectos de IA y se comunica a la direcciÃ³n?',
      'Â¿Se contemplan aspectos de gobernanza y Ã©tica de datos/IA en la estrategia?',
      'Â¿La estrategia incluye planes para escalar la IA a otras Ã¡reas una vez probada?',
      'Â¿La visiÃ³n digital e IA estÃ¡ comunicada a todos los niveles de la organizaciÃ³n?',
      'Â¿Existe un programa de difusiÃ³n interna de logros y aprendizajes digitales?',
      'Â¿La estrategia contempla cÃ³mo gestionar el cambio cultural derivado de la digitalizaciÃ³n?',
      'Â¿Se involucra a los clientes/usuarios en la definiciÃ³n de la estrategia digital (co-creaciÃ³n)?',
      'Â¿Se realiza vigilancia competitiva y de tendencias para ajustar la estrategia?',
      'Â¿La estrategia considera escenarios de crisis y resiliencia digital (continuidad de operaciones)?',
      'Â¿Se integran aprendizajes de proyectos anteriores en la planificaciÃ³n futura?',
      'Â¿Se definen objetivos de madurez digital y mÃ©tricas (DQ) para ser alcanzados en periodos concretos?',
      'Â¿La estrategia incorpora IA para optimizar procesos internos ademÃ¡s de la experiencia del cliente?',
      'Â¿La estrategia digital estÃ¡ alineada con la estrategia de datos e infraestructura?'
    ],
    infra: [
      'Â¿La infraestructura tecnolÃ³gica estÃ¡ documentada (redes, servidores, nube, on-premise)?',
      'Â¿Se utilizan servicios en la nube (IaaS/PaaS/SaaS) para habilitar escalabilidad y rapidez?',
      'Â¿La organizaciÃ³n tiene un data lake o repositorio centralizado de datos?',
      'Â¿Se integran datos de diferentes fuentes en un repositorio unificado?',
      'Â¿Existen diccionarios de datos y modelos de datos documentados?',
      'Â¿Hay polÃ­ticas y procedimientos para asegurar la calidad de los datos (limpieza, deduplicaciÃ³n)?',
      'Â¿Se realizan auditorÃ­as periÃ³dicas de la calidad de los datos?',
      'Â¿La organizaciÃ³n cuenta con un equipo de gestiÃ³n de datos (arquitecto de datos, steward)?',
      'Â¿Se tienen protocolos de catalogaciÃ³n y clasificaciÃ³n de datos (metadatos)?',
      'Â¿Existen controles de ciberseguridad (firewalls, IDS, cifrado) y estÃ¡n certificados?',
      'Â¿Se cuenta con un plan de continuidad de negocio y recuperaciÃ³n ante desastres para sistemas crÃ­ticos?',
      'Â¿Los accesos a sistemas y bases de datos se gestionan mediante polÃ­ticas de identidad y privilegios mÃ­nimos?',
      'Â¿Se realiza capacitaciÃ³n en seguridad de la informaciÃ³n al personal?',
      'Â¿Se usan herramientas de inteligencia de negocios (BI) para visualizar datos?',
      'Â¿Existen entornos de anÃ¡lisis de datos avanzados (notebooks, servidores de ML) accesibles para el equipo?',
      'Â¿Se dispone de una plataforma para desarrollar, probar y desplegar modelos de IA (MLOps)?',
      'Â¿Hay pipelines automatizados para ingesta, preparaciÃ³n y actualizaciÃ³n de datos?',
      'Â¿Se usan servicios de bases de datos en la nube (relacionales y NoSQL) de forma eficiente?',
      'Â¿Los sistemas de TI estÃ¡n integrados (middleware, APIs) para evitar silos de informaciÃ³n?',
      'Â¿Existe un catÃ¡logo de APIs disponibles para consumo interno/externo?',
      'Â¿Las herramientas de software y datos utilizados cuentan con licencias y permisos adecuados?',
      'Â¿Se monitorea el desempeÃ±o de la infraestructura (uso de recursos, tiempos de respuesta)?',
      'Â¿Los datos disponibles son suficientes para entrenar modelos de IA?',
      'Â¿Se sigue un proceso para etiquetar datos (data labeling) cuando se requiere?',
      'Â¿Hay procedimientos para anonimizar o seudonimizar datos sensibles?',
      'Â¿Se rigen por polÃ­ticas de gobernanza de datos (quiÃ©n crea, consume, elimina)?',
      'Â¿Existen acuerdos de nivel de servicio (SLAs) claros para plataformas de datos?',
      'Â¿Se evalÃºan periÃ³dicamente los proveedores de infraestructura y plataformas de datos?',
      'Â¿Se implementan soluciones de gestiÃ³n de identidades y accesos (IAM) con autenticaciÃ³n multifactor?',
      'Â¿La organizaciÃ³n tiene un marco de trabajo de ciberseguridad alineado a estÃ¡ndares (ISO 27001, NIST)?'
    ],
    talento: [
      'Â¿La mayorÃ­a del personal maneja herramientas digitales bÃ¡sicas (ofimÃ¡tica, plataformas colaborativas)?',
      'Â¿Se realizan programas continuos de formaciÃ³n en habilidades digitales y de datos?',
      'Â¿La organizaciÃ³n ofrece capacitaciÃ³n en metodologÃ­as Ã¡giles y design thinking?',
      'Â¿Se capacita a los empleados en fundamentos de IA y analÃ­tica avanzada?',
      'Â¿Se cuenta con estrategias para atraer talento digital (reclutamiento especializado, ferias tecnolÃ³gicas)?',
      'Â¿Se contratan perfiles en ciencia de datos, ingenierÃ­a de datos y arquitectura de nube?',
      'Â¿Existen programas de desarrollo de carrera y reconocimiento para retener talento digital?',
      'Â¿La estructura salarial incentiva la retenciÃ³n de perfiles tÃ©cnicos crÃ­ticos?',
      'Â¿Los equipos colaboran entre sÃ­ (no existen silos funcionales)?',
      'Â¿Se promueven comunidades de prÃ¡ctica o capÃ­tulos internos de analÃ­tica y tecnologÃ­a?',
      'Â¿Se fomenta el aprendizaje continuo (acceso a cursos, certificaciones, conferencias)?',
      'Â¿La organizaciÃ³n adopta metodologÃ­as Ã¡giles (scrum, kanban) en proyectos digitales?',
      'Â¿Los equipos multidisciplinarios son permanentes (squads) o se forman ad hoc?',
      'Â¿Existe apertura al cambio y tolerancia a la experimentaciÃ³n/fracaso?',
      'Â¿La cultura recompensa la generaciÃ³n de ideas y la resoluciÃ³n creativa de problemas?',
      'Â¿Se impulsa la diversidad de gÃ©nero, edad y perspectivas en los equipos digitales?',
      'Â¿Existe un programa de gestiÃ³n del cambio para acompaÃ±ar la digitalizaciÃ³n?',
      'Â¿El liderazgo comunica consistentemente la importancia de la transformaciÃ³n digital?',
      'Â¿Se incentiva la participaciÃ³n del talento en eventos o hackatones externos?',
      'Â¿Se detectan barreras culturales al adoptar nuevas tecnologÃ­as?',
      'Â¿Existe mentorÃ­a o coaching para desarrollar habilidades digitales entre equipos?',
      'Â¿Se promueve el balance vida-trabajo en proyectos digitales (evitando burnout)?',
      'Â¿Los empleados reciben capacitaciÃ³n sobre Ã©tica digital, privacidad y uso responsable de IA?',
      'Â¿Hay una polÃ­tica de comunicaciÃ³n abierta para reportar riesgos o malas prÃ¡cticas digitales?',
      'Â¿La organizaciÃ³n participa en comunidades de cÃ³digo abierto o foros de best practices?',
      'Â¿Se ofrecen modalidades de trabajo flexible (remoto/hÃ­brido) para atraer talento digital?',
      'Â¿El Ã¡rea de RR.HH. tiene competencias en gestiÃ³n del talento digital?',
      'Â¿Se revisan los modelos de IA para evitar sesgos y se involucra al equipo en la revisiÃ³n?',
      'Â¿Se miden tasas de rotaciÃ³n en perfiles digitales y se analizan sus causas?',
      'Â¿La cultura digital estÃ¡ alineada con valores Ã©ticos y de responsabilidad social?'
    ],
    gob: [
      'Â¿Existe un comitÃ© o consejo de transformaciÃ³n digital e IA?',
      'Â¿Se han definido roles y responsabilidades claras para la gobernanza digital (director digital, owner de producto, etc.)?',
      'Â¿La gobernanza digital forma parte del gobierno corporativo general?',
      'Â¿Las decisiones de inversiÃ³n digital se aprueban en base a criterios establecidos (ROI, riesgo, alineaciÃ³n estratÃ©gica)?',
      'Â¿Se tienen polÃ­ticas de datos (acceso, custodia, privacidad) aprobadas y comunicadas?',
      'Â¿Existe un cÃ³digo Ã©tico para el uso de IA y datos personales?',
      'Â¿Las polÃ­ticas de TI incluyen lineamientos para la adquisiciÃ³n y desactivaciÃ³n de sistemas?',
      'Â¿Se identifican, analizan y gestionan los riesgos digitales (ciberataques, obsolescencia, cumplimiento)?',
      'Â¿Hay un equipo responsable de continuidad de negocio y gestiÃ³n de crisis digitales?',
      'Â¿Se definen indicadores de desempeÃ±o digital e IA (KPIs) y se monitorean regularmente?',
      'Â¿Existe un sistema de reportes o dashboard para gobernanza (real-time o periÃ³dicos) con acceso a la direcciÃ³n?',
      'Â¿Los proyectos digitales tienen un modelo de financiaciÃ³n claro (centro de costos o inversiÃ³n estratÃ©gica)?',
      'Â¿Se realizan auditorÃ­as internas o externas de cumplimiento digital/IA?',
      'Â¿Hay un comitÃ© especÃ­fico para revisar proyectos de IA (validaciÃ³n de modelos, Ã©tica)?',
      'Â¿Se controla formalmente el impacto de cambios tecnolÃ³gicos sobre procesos y roles?',
      'Â¿La gobernanza contempla la protecciÃ³n de derechos de propiedad intelectual en desarrollos digitales?',
      'Â¿Los directivos reciben reportes frecuentes sobre el estado de la transformaciÃ³n?',
      'Â¿Se establecen acuerdos de nivel de servicio y contratos para asegurar la calidad con proveedores de tecnologÃ­a?',
      'Â¿La gobernanza digital interactÃºa con Ã¡reas de cumplimiento (legal, regulatorio) para asegurar alineaciÃ³n?',
      'Â¿Se incluye la dimensiÃ³n de talento y cultura en la gobernanza (comitÃ© de talento digital)?',
      'Â¿Se revisan proyectos fallidos para extraer lecciones y evitar repetir errores?',
      'Â¿Se mantiene un inventario y registro de activos de datos crÃ­ticos?',
      'Â¿Se asignan responsables (data owners) para cada conjunto de datos?',
      'Â¿Se comunican al negocio las decisiones de gobernanza y su racional?',
      'Â¿Los responsables de la toma de decisiones disponen de informaciÃ³n en tiempo real para sus deliberaciones?',
      'Â¿La gobernanza fomenta la coordinaciÃ³n entre Ã¡reas (por ejemplo, planeaciÃ³n, TI, operaciones, marketing)?',
      'Â¿Se actualizan las polÃ­ticas digitales en funciÃ³n de nuevas leyes (protecciÃ³n de datos, IA, ciberseguridad)?',
      'Â¿Se contempla la contrataciÃ³n de asesorÃ­a externa para temas especÃ­ficos de gobernanza o ciberseguridad?',
      'Â¿El comitÃ© de gobernanza revisa periÃ³dicamente la alineaciÃ³n de iniciativas de IA con objetivos y riesgos?',
      'Â¿La alta direcciÃ³n impulsa una cultura de datos apoyada en la gobernanza (data-driven)?'
    ],
    procesos: [
      'Â¿Los procesos clave estÃ¡n identificados y documentados (mapas de procesos)?',
      'Â¿Existe un equipo responsable de la mejora continua de procesos?',
      'Â¿Se utilizan herramientas de mapeo y anÃ¡lisis de procesos (BPMN, process mining)?',
      'Â¿Los flujos de trabajo estÃ¡n estandarizados en toda la organizaciÃ³n?',
      'Â¿Se han implementado soluciones de automatizaciÃ³n (p.ej., RPA) para tareas repetitivas?',
      'Â¿Se utilizan chatbots u otros asistentes digitales para automatizar tareas de atenciÃ³n?',
      'Â¿Se aplica IA para mejorar la eficiencia de procesos (predicciÃ³n de demanda, mantenimiento predictivo)?',
      'Â¿Los procesos automatizados se integran con sistemas existentes (ERP/CRM/BPM)?',
      'Â¿Se realizan pilotos de automatizaciÃ³n con control de impacto antes de escalar?',
      'Â¿Se mide el retorno de inversiÃ³n y la reducciÃ³n de tiempos/costos tras automatizar un proceso?',
      'Â¿Los cambios en procesos se implementan de manera Ã¡gil (iteraciones cortas)?',
      'Â¿La organizaciÃ³n mantiene manuales de procedimientos actualizados?',
      'Â¿Se tienen indicadores de desempeÃ±o de procesos (tiempos de ciclo, errores, productividad)?',
      'Â¿Los procesos se revisan periÃ³dicamente para optimizarlos (lean, six sigma)?',
      'Â¿Las automatizaciones estÃ¡n diseÃ±adas para escalar a mÃ¡s Ã¡reas o volumen?',
      'Â¿La automatizaciÃ³n estÃ¡ orientada a complementar el trabajo humano en lugar de reemplazarlo sin preparaciÃ³n?',
      'Â¿Se capacita al personal para trabajar con herramientas de automatizaciÃ³n e IA?',
      'Â¿Se utilizan plataformas de orquestaciÃ³n de procesos inteligentes (incluyendo IA)?',
      'Â¿Los resultados de procesos automatizados se integran en dashboards de gestiÃ³n en tiempo real?',
      'Â¿Existen polÃ­ticas para la gestiÃ³n de bots de RPA (ciclo de vida, permisos, mantenimiento)?',
      'Â¿La priorizaciÃ³n de procesos a automatizar se basa en criterios claros (volumen, valor, complejidad)?',
      'Â¿Se evalÃºan riesgos operativos y de seguridad antes de automatizar?',
      'Â¿Se comunican al personal las actividades automatizadas y sus implicaciones?',
      'Â¿Hay mecanismos para monitorear y corregir automatizaciones cuando producen resultados errÃ³neos?',
      'Â¿Se emplean analÃ­ticas avanzadas para identificar cuellos de botella y oportunidades de automatizaciÃ³n?',
      'Â¿Los procesos integran recomendaciones de IA en tiempo real para la toma de decisiones?',
      'Â¿Se emplean reglas de negocio automatizadas para gestionar procesos (decision engines)?',
      'Â¿Las soluciones de automatizaciÃ³n son compatibles con mÃºltiples plataformas y aplicaciones?',
      'Â¿Se realiza benchmarking interno y externo para identificar mejores prÃ¡cticas de automatizaciÃ³n?',
      'Â¿Existe un roadmap de automatizaciÃ³n con hitos, responsables y recursos asignados?'
    ],
    cx: [
      'Â¿La organizaciÃ³n tiene mapeados los journeys del cliente (customer journey maps)?',
      'Â¿Se recolectan datos en todos los puntos de contacto (tienda, web, app, call center)?',
      'Â¿Se utilizan plataformas omnicanal (CRM, CDP) para gestionar la relaciÃ³n con el cliente?',
      'Â¿Los canales digitales ofrecen una experiencia coherente con los canales fÃ­sicos?',
      'Â¿Se segmenta a los clientes y se personalizan ofertas y contenidos?',
      'Â¿Se emplea IA para recomendaciones (p.ej., motores de recomendaciÃ³n, marketing predictivo)?',
      'Â¿Se utilizan bots o agentes virtuales para servicio al cliente?',
      'Â¿Se miden las interacciones de los chatbots y su satisfacciÃ³n?',
      'Â¿Se analiza el feedback de clientes (opiniones, reseÃ±as, redes sociales) para detectar satisfacciÃ³n/dolor?',
      'Â¿Existe un programa formal de gestiÃ³n de feedback del cliente (NPS, encuestas de satisfacciÃ³n)?',
      'Â¿Los tiempos de atenciÃ³n al cliente se monitorean y se mejoran continuamente?',
      'Â¿Las interfaces digitales cumplen estÃ¡ndares de accesibilidad (WCAG) para usuarios con discapacidad?',
      'Â¿Las comunicaciones al cliente son consistentes y claras en todos los canales?',
      'Â¿El cliente puede comenzar la interacciÃ³n en un canal y continuarla en otro sin fricciÃ³n?',
      'Â¿Se utilizan algoritmos de detecciÃ³n de abandono o churn para prevenir pÃ©rdida de clientes?',
      'Â¿Se aplican modelos de scoring o propensiÃ³n de compra para campaÃ±as de marketing?',
      'Â¿Los equipos de marketing y atenciÃ³n tienen dashboards con mÃ©tricas de clientes en tiempo real?',
      'Â¿Se realizan pruebas con usuarios para optimizar la experiencia digital?',
      'Â¿Se consideran criterios de inclusividad y diversidad en el diseÃ±o de servicios?',
      'Â¿Los canales digitales protegen la informaciÃ³n del cliente (SSL, polÃ­ticas de privacidad)?',
      'Â¿Se comunica de manera transparente el uso de cookies y se da control al usuario?',
      'Â¿Se miden indicadores como NPS, CES (Customer Effort Score) y se actÃºa sobre ellos?',
      'Â¿Se realizan iteraciones y experimentos A/B para mejorar la experiencia?',
      'Â¿Se evalÃºa la Ã©tica de algoritmos que interactÃºan con el cliente (evitar discriminaciÃ³n)?',
      'Â¿Se usan modelos predictivos para anticipar necesidades y ofrecer soluciones antes de que el cliente contacte?',
      'Â¿Los modelos de IA estÃ¡n integrados en diferentes canales (voz, texto, redes)?',
      'Â¿Se monitorizan redes sociales y plataformas de reseÃ±as en tiempo real para responder a incidentes?',
      'Â¿Se calcula y se usa el CLV para estrategias de retenciÃ³n?',
      'Â¿Se gestionan programas de fidelizaciÃ³n basados en datos y analÃ­tica?',
      'Â¿Existen servicios digitales para instalaciÃ³n, soporte y garantÃ­a que reduzcan fricciÃ³n despuÃ©s de la venta?'
    ]
  };

  const state = {
    answers: {},
    submitted: {},
    scores: {}
  };

  const interpretations = {
    estrategia: {
      low: 'Falta una visiÃ³n digital/IA consolidada y KPIs claros. Prioriza hoja de ruta, patrocinio ejecutivo y casos de negocio con ROI.',
      mid: 'La estrategia existe pero requiere ajustar portafolio y mediciÃ³n. Alinea casos de IA al negocio y comunica avances.',
      high: 'VisiÃ³n y roadmap digitales claros. El foco es escalar IA y explorar nuevos modelos de negocio basados en datos.'
    },
    infra: {
      low: 'Base tecnolÃ³gica fragmentada. Urge estandarizar datos, fortalecer ciberseguridad y habilitar nube/MLops bÃ¡sicos.',
      mid: 'Infraestructura en marcha; mejorar calidad de datos, integraciÃ³n y monitoreo para soportar IA a escala.',
      high: 'Plataforma sÃ³lida. Enfoca en optimizar costos, automatizar pipelines y habilitar autoservicio de datos/IA.'
    },
    talento: {
      low: 'Brechas de skills digitales/IA y cultura Ã¡gil. Requiere upskilling masivo y comunidades de prÃ¡ctica.',
      mid: 'Talento mixto con lagunas en IA y agilidad. Refuerza rutas de carrera, coaching y tiempos para innovar.',
      high: 'Equipos maduros. Acelera especializaciÃ³n en IA aplicada y programas de retenciÃ³n para roles crÃ­ticos.'
    },
    gob: {
      low: 'Gobernanza digital incipiente. Define roles, comitÃ©s, polÃ­ticas de datos/Ã©tica y gestiÃ³n de riesgos.',
      mid: 'Marco de gobierno activo pero incompleto. Fortalece mÃ©tricas, control de cambios y revisiÃ³n periÃ³dica de IA.',
      high: 'Gobernanza consolidada. Escala transparencia, auditorÃ­as continuas y alineaciÃ³n con nuevas regulaciones.'
    },
    procesos: {
      low: 'Procesos poco documentados y baja automatizaciÃ³n. Prioriza mapeo, estandarizaciÃ³n y pilotos RPA/IA.',
      mid: 'AutomatizaciÃ³n selectiva. Expande monitoreo, ROI y orquestaciÃ³n para escalar sin silos.',
      high: 'Flujos maduros. Optimiza con analÃ­tica avanzada y gobernanza de bots para mantener calidad y resiliencia.'
    },
    cx: {
      low: 'Experiencia digital dispareja. Necesita datos omnicanal, NPS y fundamentos de personalizaciÃ³n.',
      mid: 'CX integrada con oportunidades de IA. Mejora pruebas A/B, accesibilidad y modelos de churn/propensiÃ³n.',
      high: 'CX robusta. Profundiza hiperpersonalizaciÃ³n Ã©tica y automatiza acciones predictivas en todos los canales.'
    }
  };

  const actionRecommendations = {
    estrategia: {
      low: {
        focus: 'Fundamentos y patrocinio',
        actions: [
          'Formalizar visiÃ³n/misiÃ³n digital e IA con aprobaciÃ³n ejecutiva.',
          'Priorizar portafolio de casos con KPIs y ROI estimado.',
          'Asignar presupuesto y roadmap de IA alineado a procesos clave.'
        ]
      },
      mid: {
        focus: 'AlineaciÃ³n y escalamiento',
        actions: [
          'Comunicar avances y quick wins a toda la organizaciÃ³n.',
          'Refinar KPIs y gobernanza de casos de IA con criterios de valor y riesgo.',
          'Planificar escalamiento de casos exitosos a nuevas Ã¡reas.'
        ]
      },
      high: {
        focus: 'Ecosistema y nuevos modelos',
        actions: [
          'Explorar alianzas con startups/universidades para innovaciÃ³n abierta.',
          'Probar nuevos modelos de negocio data-driven y generativa.',
          'Monitorear riesgos y Ã©tica en despliegues masivos de IA.'
        ]
      }
    },
    infra: {
      low: {
        focus: 'Base tecnolÃ³gica segura',
        actions: [
          'Documentar arquitectura y polÃ­ticas de ciberseguridad.',
          'Implementar data lake mÃ­nimo viable con gobierno de accesos.',
          'Habilitar herramientas BI y etiquetado de datos para IA.'
        ]
      },
      mid: {
        focus: 'Calidad y MLOps',
        actions: [
          'Automatizar pipelines de ingesta/limpieza con monitoreo.',
          'Consolidar catÃ¡logo de APIs y SLAs de datos.',
          'Desplegar plataforma MLOps con control de versiones y despliegue.'
        ]
      },
      high: {
        focus: 'Autoservicio y optimizaciÃ³n',
        actions: [
          'Optimizar costos nube y performance con observabilidad.',
          'Expandir autoservicio de datos/IA para equipos de negocio.',
          'Evaluar periodicidad de auditorÃ­as de calidad y seguridad.'
        ]
      }
    },
    talento: {
      low: {
        focus: 'Upskilling urgente',
        actions: [
          'Programa intensivo de habilidades digitales e IA bÃ¡sica.',
          'Crear comunidades de prÃ¡ctica y mentoring entre equipos.',
          'Ajustar compensaciÃ³n/retenciÃ³n para roles crÃ­ticos.'
        ]
      },
      mid: {
        focus: 'EspecializaciÃ³n y agilidad',
        actions: [
          'Certificar lÃ­deres en metodologÃ­as Ã¡giles y product management.',
          'Asignar tiempo protegido para experimentaciÃ³n y hackatones.',
          'Refinar rutas de carrera y evaluaciÃ³n de desempeÃ±o digital.'
        ]
      },
      high: {
        focus: 'RetenciÃ³n y IA aplicada',
        actions: [
          'Incentivar investigaciÃ³n aplicada y patentes internas.',
          'RotaciÃ³n planificada entre squads para compartir expertise.',
          'Programas de bienestar y flexibilidad para evitar rotaciÃ³n.'
        ]
      }
    },
    gob: {
      low: {
        focus: 'Marco mÃ­nimo de control',
        actions: [
          'Constituir comitÃ© digital/IA con roles y responsabilidades.',
          'Publicar polÃ­ticas de datos, privacidad y Ã©tica de IA.',
          'Implementar gestiÃ³n de riesgos y continuidad de negocio.'
        ]
      },
      mid: {
        focus: 'Riesgos y mÃ©tricas',
        actions: [
          'Integrar KPIs de transformaciÃ³n en tableros ejecutivos.',
          'Auditar proyectos IA (sesgos, desempeÃ±o, cumplimiento).',
          'Fortalecer control de cambios y propiedad de datos.'
        ]
      },
      high: {
        focus: 'Transparencia y cumplimiento',
        actions: [
          'Automatizar reportes de gobernanza y trazabilidad de modelos.',
          'Alinear con nuevas normativas de IA y protecciÃ³n de datos.',
          'Revisar contratos y SLAs crÃ­ticos con proveedores tecnolÃ³gicos.'
        ]
      }
    },
    procesos: {
      low: {
        focus: 'Documentar y priorizar',
        actions: [
          'Mapear procesos clave y definir mÃ©tricas base.',
          'Ejecutar pilotos RPA/IA en tareas repetitivas.',
          'Alinear automatizaciÃ³n con gestiÃ³n del cambio y capacitaciÃ³n.'
        ]
      },
      mid: {
        focus: 'Escala y orquestaciÃ³n',
        actions: [
          'Usar process mining para identificar cuellos de botella.',
          'Centralizar monitoreo de bots y flujos automatizados.',
          'Medir ROI y ajustar priorizaciÃ³n de automatizaciones.'
        ]
      },
      high: {
        focus: 'OptimizaciÃ³n continua',
        actions: [
          'Incorporar IA en decisiones en tiempo real.',
          'Asegurar interoperabilidad y resiliencia en mÃºltiples plataformas.',
          'Benchmarking periÃ³dico contra lÃ­deres del sector.'
        ]
      }
    },
    cx: {
      low: {
        focus: 'Fundamentos de omnicanalidad',
        actions: [
          'Mapear journeys y unificar captura de datos en todos los puntos.',
          'Implementar mediciÃ³n NPS/CES y feedback continuo.',
          'Establecer estÃ¡ndares de accesibilidad y coherencia de canales.'
        ]
      },
      mid: {
        focus: 'PersonalizaciÃ³n y Ã©tica',
        actions: [
          'Desplegar modelos de recomendaciÃ³n y churn con monitoreo.',
          'A/B testing y analÃ­tica de sentimiento para iterar UX.',
          'PolÃ­ticas de transparencia sobre uso de datos y cookies.'
        ]
      },
      high: {
        focus: 'HiperpersonalizaciÃ³n confiable',
        actions: [
          'Orquestar IA en todos los canales (voz, texto, app, web).',
          'Automatizar acciones proactivas basadas en predicciÃ³n de necesidades.',
          'Revisar sesgos y equidad en modelos de cara al cliente.'
        ]
      }
    }
  };

  const downloadBtn = document.getElementById('downloadZip');
  const downloadStatus = document.getElementById('downloadStatus');
  const defaultReadme = `# BaterÃ­a MD-IA (AlgoritmoT)

Cuestionario interactivo de 180 preguntas (30 por dimensiÃ³n) para evaluar madurez digital e IA. Incluye cÃ¡lculo dinÃ¡mico de DQ y AIQ, radar y barras de resultados.

## Uso

1. Pulsa "Generar paquete offline" en el dashboard. El ZIP se construye en tu navegador con los archivos actuales (sin descargar binarios del repositorio).
2. Guarda y extrae el ZIP generado; abre \`index.html\` en tu navegador moderno (no requiere backend ni conexiÃ³n una vez descargado).
3. Responde cada dimensiÃ³n en su pestaÃ±a y presiona **Enviar dimensiÃ³n** para actualizar el tablero.
4. Consulta las pestaÃ±as "Resultados" y "LÃ­neas de acciÃ³n" para revisar radar, barras, anÃ¡lisis por dimensiÃ³n y recomendaciones.

## Contenido del paquete generado

- \`index.html\`: interfaz completa con preguntas, progresos, cÃ¡lculos y grÃ¡ficos.
- \`README.md\`: esta guÃ­a de uso.
`;

  async function safeFetchText(path) {
    try {
      const res = await fetch(path);
      if (!res.ok) throw new Error(`Status ${res.status}`);
      return await res.text();
    } catch (e) {
      return null;
    }
  }

  async function getIndexSource() {
    const fetched = await safeFetchText('index.html');
    if (fetched) return fetched;
    return '<!DOCTYPE html>\n' + document.documentElement.outerHTML;
  }

  async function getReadmeSource() {
    const fetched = await safeFetchText('README.md');
    if (fetched) return fetched;
    return defaultReadme;
  }

  async function generateZip() {
    if (!window.JSZip) {
      downloadStatus.textContent = 'No se pudo cargar JSZip desde CDN. Verifica tu conexiÃ³n.';
      return;
    }
    downloadBtn.disabled = true;
    downloadBtn.textContent = 'Generando...';
    downloadStatus.textContent = 'Preparando archivos (index.html y README.md)';
    try {
      const [html, readme] = await Promise.all([getIndexSource(), getReadmeSource()]);
      const zip = new JSZip();
      zip.file('index.html', html);
      zip.file('README.md', readme);
      const blob = await zip.generateAsync({ type: 'blob' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'mdia-cuestionario.zip';
      a.click();
      setTimeout(() => URL.revokeObjectURL(url), 4000);
      downloadStatus.textContent = 'ZIP generado localmente. Ya puedes abrirlo offline.';
    } catch (e) {
      console.error(e);
      downloadStatus.textContent = 'Error al generar el ZIP. Refresca la pÃ¡gina e intÃ©ntalo de nuevo.';
    } finally {
      downloadBtn.disabled = false;
      downloadBtn.textContent = 'Generar paquete offline';
    }
  }

  const tabsNav = document.getElementById('tabs');
  const panelsContainer = document.getElementById('panels');
  const dimensionProgress = document.getElementById('dimensionProgress');

  function createTabs() {
    const resumenBtn = document.createElement('button');
    resumenBtn.className = 'tab-btn active';
    resumenBtn.textContent = 'ðŸ Resumen y progreso';
    resumenBtn.dataset.target = 'panel-resumen';
    tabsNav.appendChild(resumenBtn);

    dimensions.forEach(dim => {
      const btn = document.createElement('button');
      btn.className = 'tab-btn';
      btn.textContent = dim.name;
      btn.dataset.target = `panel-${dim.id}`;
      tabsNav.appendChild(btn);
    });

    const resultsBtn = document.createElement('button');
    resultsBtn.className = 'tab-btn';
    resultsBtn.textContent = 'ðŸ“Š Resultados';
    resultsBtn.dataset.target = 'panel-resultados';
    tabsNav.appendChild(resultsBtn);

    const actionsBtn = document.createElement('button');
    actionsBtn.className = 'tab-btn';
    actionsBtn.textContent = 'ðŸš€ LÃ­neas de acciÃ³n';
    actionsBtn.dataset.target = 'panel-acciones';
    tabsNav.appendChild(actionsBtn);

    tabsNav.addEventListener('click', (e) => {
      if (!e.target.classList.contains('tab-btn')) return;
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
      e.target.classList.add('active');
      const target = document.getElementById(e.target.dataset.target);
      if (target) target.classList.add('active');
    });
  }

  function createProgressCards() {
    dimensionProgress.innerHTML = '';
    dimensions.forEach(dim => {
      const card = document.createElement('div');
      card.className = 'card';
      card.id = `progress-${dim.id}`;
      card.innerHTML = `
        <div class="card-header">
          <div>
            <div class="card-title">${dim.name}</div>
            <div class="card-subtitle" id="progress-label-${dim.id}">0/30 respuestas Â· Sin enviar</div>
          </div>
          <span class="chip" id="chip-${dim.id}">Pendiente</span>
        </div>
        <div class="progress"><div class="progress-bar" id="bar-${dim.id}"></div></div>
      `;
      dimensionProgress.appendChild(card);
    });
  }

  function createPanels() {
    dimensions.forEach(dim => {
      const panel = document.createElement('section');
      panel.className = 'panel';
      panel.id = `panel-${dim.id}`;
      const qList = questions[dim.id];
      panel.innerHTML = `
        <div class="card">
          <div class="card-header">
            <div>
              <div class="card-title">${dim.name}</div>
              <div class="card-subtitle">30 preguntas Â· completa y presiona "Enviar" para actualizar el tablero.</div>
            </div>
            <div class="chip" id="dim-status-${dim.id}">Sin enviar</div>
          </div>
          <div class="progress"><div class="progress-bar" id="dim-bar-${dim.id}"></div></div>
          <div class="small muted" id="dim-progress-${dim.id}" style="margin-top:6px;">0 de 30 respondidas</div>
          <div class="question-list" id="questions-${dim.id}"></div>
          <button class="submit" data-dimension="${dim.id}">Enviar dimensiÃ³n</button>
          <div class="status" id="status-${dim.id}">Completa todas las respuestas antes de enviar.</div>
        </div>
      `;
      panelsContainer.appendChild(panel);

      const qContainer = panel.querySelector(`#questions-${dim.id}`);
      qList.forEach((q, idx) => {
        const qItem = document.createElement('article');
        qItem.className = 'question';
        qItem.innerHTML = `
          <h4>${idx + 1}. ${q}</h4>
          <div class="options">
            ${[1,2,3,4,5].map(v => `
              <label>
                <input type="radio" name="${dim.id}-${idx}" value="${v}" data-dimension="${dim.id}" data-index="${idx}" />
                <span>${v}</span>
                <span class="muted">${labelForValue(v)}</span>
              </label>
            `).join('')}
          </div>
        `;
        qContainer.appendChild(qItem);
      });

      panel.querySelector('button.submit').addEventListener('click', () => handleSubmit(dim.id));
      panel.addEventListener('change', handleAnswerChange);
    });
  }

  function labelForValue(v) {
    const labels = {
      1: 'No se hace / no existe',
      2: 'Muy poco implementado',
      3: 'Parcialmente implementado',
      4: 'Bien implementado',
      5: 'Totalmente optimizado'
    };
    return labels[v];
  }

  function handleAnswerChange(e) {
    if (e.target.tagName !== 'INPUT') return;
    const dim = e.target.dataset.dimension;
    const idx = e.target.dataset.index;
    const value = Number(e.target.value);
    if (!state.answers[dim]) state.answers[dim] = {};
    state.answers[dim][idx] = value;
    updateProgress();
  }

  function updateProgress() {
    let totalAnswered = 0;
    dimensions.forEach(dim => {
      const answered = state.answers[dim.id] ? Object.keys(state.answers[dim.id]).length : 0;
      totalAnswered += answered;
      const percent = (answered / 30) * 100;
      document.getElementById(`bar-${dim.id}`).style.width = `${percent}%`;
      document.getElementById(`dim-bar-${dim.id}`).style.width = `${percent}%`;
      document.getElementById(`progress-label-${dim.id}`).textContent = `${answered}/30 respuestas Â· ${state.submitted[dim.id] ? 'Enviado' : 'Sin enviar'}`;
      document.getElementById(`dim-progress-${dim.id}`).textContent = `${answered} de 30 respondidas`;
      const chip = document.getElementById(`chip-${dim.id}`);
      chip.textContent = state.submitted[dim.id] ? 'Enviado' : (answered > 0 ? 'En curso' : 'Pendiente');
      chip.style.background = state.submitted[dim.id] ? 'rgba(34,197,94,0.15)' : 'rgba(255,255,255,0.04)';
      chip.style.borderColor = state.submitted[dim.id] ? 'rgba(34,197,94,0.35)' : 'var(--border)';
    });
    const overallPercent = Math.round((totalAnswered / 180) * 100);
    document.getElementById('progressPercent').textContent = `${overallPercent}%`;
    document.getElementById('progressBar').style.width = `${overallPercent}%`;
    document.getElementById('progressDetail').textContent = `${totalAnswered} de 180 respuestas registradas`;
    document.getElementById('dimsSubmitted').textContent = `${Object.keys(state.submitted).length} / 6`;
  }

  function handleSubmit(dimId) {
    const dimAnswers = state.answers[dimId] || {};
    if (Object.keys(dimAnswers).length < 30) {
      setStatus(dimId, 'Responde las 30 preguntas antes de enviar.');
      return;
    }
    const values = Object.values(dimAnswers).map(Number);
    const avgLikert = values.reduce((a,b) => a + b, 0) / values.length;
    const percentScore = (avgLikert - 1) * 25; // 1->0, 5->100
    state.submitted[dimId] = true;
    state.scores[dimId] = Math.round(percentScore * 10) / 10;
    document.getElementById(`dim-status-${dimId}`).textContent = `Enviado Â· Puntaje ${state.scores[dimId]}%`;
    setStatus(dimId, 'DimensiÃ³n enviada. El tablero se ha actualizado.');
    updateProgress();
    updateResults();
  }

  function setStatus(dimId, text) {
    const el = document.getElementById(`status-${dimId}`);
    if (el) el.textContent = text;
  }

  function computeDQAIQ() {
    const submittedDims = dimensions.filter(d => state.submitted[d.id]);
    if (submittedDims.length === 0) return { dq: null, aiq: null, partial: true };
    const dq = submittedDims.reduce((sum, d) => sum + state.scores[d.id], 0) / submittedDims.length;
    const totalWeight = submittedDims.reduce((sum, d) => sum + d.weightAIQ, 0);
    const aiq = submittedDims.reduce((sum, d) => sum + state.scores[d.id] * d.weightAIQ, 0) / totalWeight;
    return { dq: Math.round(dq * 10) / 10, aiq: Math.round(aiq * 10) / 10, partial: submittedDims.length !== dimensions.length };
  }

  function levelForScore(score) {
    if (score === null || score === undefined) return { label: 'Pendiente', className: '', key: 'pending' };
    if (score < 34) return { label: 'Bajo', className: 'bajo', key: 'low' };
    if (score < 67) return { label: 'Intermedio', className: 'intermedio', key: 'mid' };
    return { label: 'Alto', className: 'alto', key: 'high' };
  }

  function renderInsights() {
    const container = document.getElementById('dimensionInsights');
    container.innerHTML = '';
    dimensions.forEach(dim => {
      const score = state.scores[dim.id];
      const level = levelForScore(score);
      const analysis = level.key === 'pending' ? 'EnvÃ­a la dimensiÃ³n para ver el anÃ¡lisis.' : interpretations[dim.id][level.key];
      const card = document.createElement('div');
      card.className = 'insight-card';
      card.innerHTML = `
        <div class="insight-head">
          <div>
            <strong>${dim.name}</strong>
            <div class="small muted">${level.key === 'pending' ? 'AÃºn no calculado' : 'InterpretaciÃ³n automatizada'}</div>
          </div>
          <span class="level ${level.className}">${level.label}</span>
        </div>
        <div class="small muted">${score === undefined ? 'Puntaje pendiente' : `Puntaje: ${score}%`}</div>
        <p>${analysis}</p>
      `;
      container.appendChild(card);
    });
  }

  function renderActions() {
    const container = document.getElementById('actionsContainer');
    const status = document.getElementById('actionStatus');
    container.innerHTML = '';
    const submitted = Object.keys(state.submitted).length > 0;
    status.textContent = submitted ? 'Personalizado con tus respuestas' : 'Esperando envÃ­os';
    status.style.background = submitted ? 'rgba(34,197,94,0.18)' : 'rgba(255,255,255,0.05)';
    status.style.borderColor = submitted ? 'rgba(34,197,94,0.35)' : 'var(--border)';

    dimensions.forEach(dim => {
      const score = state.scores[dim.id];
      const level = levelForScore(score);
      const recSet = actionRecommendations[dim.id][level.key] || { focus: 'Completa la dimensiÃ³n para ver recomendaciones.', actions: [] };
      const card = document.createElement('div');
      card.className = 'action-card';
      card.innerHTML = `
        <div class="insight-head">
          <div>
            <strong>${dim.name}</strong>
            <div class="small muted">${level.key === 'pending' ? 'Sin puntaje aÃºn' : recSet.focus}</div>
          </div>
          <span class="level ${level.className}">${level.label}</span>
        </div>
        <div class="small muted">${score === undefined ? 'Completa y envÃ­a para priorizar' : `Puntaje: ${score}%`}</div>
        ${recSet.actions.length ? `<div class="pill-sm">Quick wins y prÃ³ximos pasos</div>` : ''}
        ${recSet.actions.length ? `<ul class="list">${recSet.actions.map(a => `<li>${a}</li>`).join('')}</ul>` : '<p class="muted small">Sin recomendaciones hasta enviar.</p>'}
      `;
      container.appendChild(card);
    });
  }

  let radarChart = null;
  let barChart = null;

  function initCharts() {
    const ctxRadar = document.getElementById('radarChart');
    const ctxBar = document.getElementById('barChart');
    radarChart = new Chart(ctxRadar, {
      type: 'radar',
      data: {
        labels: dimensions.map(d => d.name),
        datasets: [{
          label: 'Puntaje por dimensiÃ³n',
          data: Array(dimensions.length).fill(null),
          fill: true,
          backgroundColor: 'rgba(37,99,235,0.18)',
          borderColor: 'rgba(37,99,235,0.9)',
          pointBackgroundColor: 'rgba(34,197,94,1)'
        }]
      },
      options: {
        responsive: true,
        scales: {
          r: {
            suggestedMin: 0,
            suggestedMax: 100,
            ticks: { stepSize: 20, backdropColor: 'transparent', color: '#94a3b8' },
            grid: { color: 'rgba(148,163,253,0.25)' },
            angleLines: { color: 'rgba(51,65,85,0.6)' },
            pointLabels: { color: '#e2e8f0', font: { size: 11 } }
          }
        },
        plugins: { legend: { labels: { color: '#e2e8f0' } } }
      }
    });

    barChart = new Chart(ctxBar, {
      type: 'bar',
      data: {
        labels: ['DQ', 'AIQ'],
        datasets: [{
          label: 'Ãndice',
          data: [0,0],
          backgroundColor: ['rgba(37,99,235,0.9)','rgba(34,197,94,0.9)']
        }]
      },
      options: {
        scales: {
          y: {
            suggestedMin: 0,
            suggestedMax: 100,
            ticks: { stepSize: 20, color: '#94a3b8' },
            grid: { color: 'rgba(148,163,253,0.25)' }
          },
          x: { ticks: { color: '#94a3b8' } }
        },
        plugins: { legend: { display: false } }
      }
    });
  }

  function updateResults() {
    const data = dimensions.map(d => state.scores[d.id] ?? null);
    radarChart.data.datasets[0].data = data;
    radarChart.update();

    const { dq, aiq, partial } = computeDQAIQ();
    const dqNode = document.getElementById('dqScore');
    const dqNote = document.getElementById('dqNote');
    const aiqNode = document.getElementById('aiqScore');
    const aiqNote = document.getElementById('aiqNote');
    const status = document.getElementById('resultStatus');

    if (dq !== null) {
      dqNode.textContent = `${dq}%`;
      dqNote.textContent = partial ? 'CÃ¡lculo parcial (dimensiones enviadas)' : 'CÃ¡lculo completo';
      aiqNode.textContent = `${aiq}%`;
      aiqNote.textContent = partial ? 'AIQ basado en dimensiones enviadas' : 'AIQ completo con ponderaciÃ³n IA';
      status.textContent = partial ? 'Parcial' : 'Completo';
      status.style.background = partial ? 'rgba(245,158,11,0.2)' : 'rgba(34,197,94,0.2)';
      status.style.borderColor = partial ? 'rgba(245,158,11,0.35)' : 'rgba(34,197,94,0.45)';
      barChart.data.datasets[0].data = [dq, aiq];
    } else {
      dqNode.textContent = 'â€”';
      dqNote.textContent = 'Esperando envÃ­os';
      aiqNode.textContent = 'â€”';
      aiqNote.textContent = 'Esperando envÃ­os';
      status.textContent = 'Pendiente de envÃ­os';
      status.style.background = 'rgba(255,255,255,0.05)';
      status.style.borderColor = 'var(--border)';
      barChart.data.datasets[0].data = [0,0];
    }
    barChart.update();
    renderInsights();
    renderActions();
  }

  if (downloadBtn) {
    downloadBtn.addEventListener('click', generateZip);
  }

  createTabs();
  createProgressCards();
  createPanels();
  initCharts();
  updateProgress();
  updateResults();
</script>
</body>
</html>
